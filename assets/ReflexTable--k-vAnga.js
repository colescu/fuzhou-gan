import{aR as E,d as q,b as y,c as l,o as a,g as G,h as i,w as B,u as N,B as H,t as h,_ as P,ap as F,aN as J,n as I,p as T,a4 as M,a2 as z,c9 as W,U as X,r as Q,k as L,F as p,s as b,x as U,i as j,W as Z,aU as K,aY as ee}from"./app-xu_rIrQu.js";import{a as x}from"./form-predict-9FcqhtJm.js";import{a as te}from"./compute-CqYnjRY-.js";import{u as ae}from"./useDraggable-9TAz5uiK.js";import{S as se}from"./StickyTable-CFrryrqS.js";import"./table-BHpxoyAt.js";function R(m){return m.map(s=>s.字數).reduce((s,r)=>r+s,0)}class ne{constructor(s,r,o){this.getX=s,this.getY=r,this.getComment=o}get data(){const s={};for(const r of Object.values(E.get())){const o=this.getX(r),u=this.getY(r);o in s||(s[o]={}),u in s[o]||(s[o][u]=[]),s[o][u].push(r)}return s}get columnData(){return Object.fromEntries(Object.entries(this.data).map(([s,r])=>{const o=R(Object.values(r).flat());return[s,Object.entries(r).map(([u,t])=>({value:u,frequency:R(t)/o,comment:this.getComment(s,u)})).sort((u,t)=>t.frequency-u.frequency)]}))}}const le={class:"block"},re=["innerHTML"],oe={class:"subsup"},ue={key:0},ce={key:1,class:"placeholder"},ie={key:0,style:{color:"var(--dark-gray)"}},ge={key:1,class:"placeholder"},de=q({__name:"Possibility",props:{possibility:{},tableUrl:{}},setup(m){const s=y(()=>m.possibility.value),r=y(()=>m.possibility.frequency),o=y(()=>m.possibility.comment);function u(){window.open(m.tableUrl,"_blank")}return(t,S)=>(a(),l("span",le,[G(N(H),{onClick:u,text:""},{default:B(()=>[i("span",{class:"text",innerHTML:s.value},null,8,re)]),_:1}),i("table",oe,[i("tbody",null,[i("tr",null,[i("td",null,[o.value?(a(),l("span",ue,h(o.value),1)):(a(),l("span",ce))])]),i("tr",null,[i("td",null,[r.value!=1?(a(),l("span",ie,h(Math.round(r.value*100))+"% ",1)):(a(),l("span",ge))])])])])]))}}),me=P(de,[["__scopeId","data-v-3afb7d13"]]),ye=["x"],fe=["language"],pe=["rowspan","innerHTML"],be=["column-key"],he={key:1,class:"center",style:{margin:"2em auto"}},_e=q({__name:"ReflexTable",props:{Xs:{},Y:{}},setup(m){const s=F(),r=J(),o=I(),u=T(o,"languages"),t=m,S=T(t,"Xs"),_=y(()=>t.Xs.map(x)),V=y(()=>t.Y.language==="lang"?M.map(n=>[n,x({...t.Y,language:n})]):[[t.Y.language,x(t.Y)]]),Y=y(()=>z(V.value.map(([n,c])=>[n,new ne(e=>JSON.stringify(_.value.map(g=>g.getter(e))),c.getter,(e,g)=>"").columnData]))),k=y(()=>{const n=W(..._.value.map(e=>e.values)),c=new Set(Object.keys(Object.values(Y.value)[0]));return n.filter(e=>c.has(JSON.stringify(e)))}),$=y(()=>te(k.value)),C=y(()=>t.Y.language==="MC"?[{key:"MC",label:"中古漢語"}]:(t.Y.language==="lang"?o.languages:[t.Y.language]).map(n=>({key:n,label:X[n]})));function w(n,{language:c,field:e}){if(c==="MC")return n;{const{show:g}=K[c];return ee(g(n,e,r.format),r.format)}}function v(n){return n.field+n.language}function A(n,c,e){return s.resolve({path:"/mc-table",query:{condition:JSON.stringify([...t.Xs.map((g,d)=>({...g,value:n[d]})),{language:e,field:t.Y.field,value:c}])}}).href}const O=Q(null);return ae(O,[{ordering:S,keyName:"x",keyGetter:v,draggable:".x"},{ordering:u,keyName:"language",draggable:".language"}]),(n,c)=>k.value.length<=300?(a(),L(se,{key:0,n:t.Xs.length},{default:B(()=>[i("thead",null,[i("tr",{ref_key:"header",ref:O},[(a(!0),l(p,null,b(t.Xs,(e,g)=>(a(),l("th",{key:v(e),group:"x",x:v(e),class:U(t.Xs.length>1?["x","clickable"]:[])},[j(h(e.language==="MC"?"中古":N(X)[e.language]),1),c[0]||(c[0]=i("br",null,null,-1)),j(" "+h(_.value[g].label),1)],10,ye))),128)),(a(!0),l(p,null,b(C.value,e=>(a(),l("th",{key:e.key,group:"language",language:e.key,class:U(N(M).includes(e.key)?["language","clickable"]:[])},h(e.label),11,fe))),128))],512)]),i("tbody",null,[(a(!0),l(p,null,b(k.value,(e,g)=>(a(),l("tr",null,[(a(!0),l(p,null,b($.value[g],(d,f)=>(a(),l(p,null,[d>0?(a(),l("th",{key:f,rowspan:d,innerHTML:w(e[f],t.Xs[f])||"無"},null,8,pe)):Z("",!0)],64))),256)),(a(!0),l(p,null,b(C.value,d=>(a(),l("td",{key:d.key,"column-key":d.key},[(a(!0),l(p,null,b(Y.value[d.key][JSON.stringify(e)],(f,D)=>(a(),L(me,{key:D,possibility:{...f,value:w(f.value,{...t.Y,language:d.key})},"table-url":A(e,f.value,d.key)},null,8,["possibility","table-url"]))),128))],8,be))),128))]))),256))])]),_:1},8,["n"])):(a(),l("div",he," 表格過大，請減少自變量的可能取值數。 "))}}),Ce=P(_e,[["__scopeId","data-v-53deb984"]]);export{Ce as default};
